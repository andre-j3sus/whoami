---
import { Icon } from "astro-icon/components";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { personal } from "@/data/personal";
import { getCollection } from "astro:content";
import BlogPostCard from "@/components/BlogPostCard.astro";

const isDev = import.meta.env.DEV;
const allPosts = await getCollection("blog", ({ data }) => isDev || !data.draft);
const sorted = allPosts.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);
---

<BaseLayout title={`Blog - ${personal.name}`} description={`Thoughts on tech, life, and everything in between by ${personal.name}`}>
  <div class="mx-auto max-w-5xl px-6 py-16 sm:py-20">
    <div class="mb-14 animate-on-scroll">
      <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold tracking-tight">Blog</h1>
        <a
          href="/rss.xml"
          target="_blank"
          class="rounded-lg p-2 text-[var(--color-text-muted)] hover:text-[var(--color-accent)] hover:bg-[var(--color-accent-light)] transition-all duration-200"
          aria-label="RSS Feed"
          title="RSS Feed"
        >
          <Icon name="lucide:rss" size={18} />
        </a>
      </div>
      <p class="mt-2 text-[var(--color-text-secondary)]">
        Thoughts on tech, life, and everything in between
      </p>
    </div>

    {sorted.length === 0 ? (
      <div class="glass-card-static py-16 text-center animate-on-scroll">
        <p class="text-[var(--color-text-muted)]">Posts coming soon.</p>
      </div>
    ) : (
      <div class="space-y-4">
        {sorted.map((post, i) => (
          <BlogPostCard post={post} delay={String(Math.min(i + 1, 6))} />
        ))}
      </div>
    )}
  </div>
</BaseLayout>
