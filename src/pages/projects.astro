---
import { Icon } from "astro-icon/components";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { personal } from "@/data/personal";
import { projects } from "@/data/projects";
import { skillCategories } from "@/data/skills";

// Build a map from tech name to icon/color/url
const techMap = new Map<string, { icon: string; color: string; darkColor?: string; url?: string }>();
skillCategories.forEach((cat) =>
  cat.skills.forEach((s) => techMap.set(s.name, { icon: s.icon, color: s.color, darkColor: s.darkColor, url: s.url }))
);
---

<BaseLayout title={`Projects - ${personal.name}`} description="Projects by AndrÃ© Jesus">
  <div class="mx-auto max-w-5xl px-6 py-16 sm:py-20">
    <div class="mb-14 animate-on-scroll">
      <h1 class="text-3xl font-bold tracking-tight">Projects</h1>
      <p class="mt-2 text-[var(--color-text-secondary)]">
        A selection of things I've built or contributed to
      </p>
    </div>

    <div class="space-y-8">
      {projects.map((project, i) => (
        <article class="glass-card p-6 sm:p-8 animate-on-scroll" data-delay={String(i + 1)}>
          <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
            <div class="flex-1">
              <h2 class="text-lg font-semibold text-[var(--color-text)]">{project.title}</h2>
              <p class="mt-1 text-sm text-[var(--color-text-muted)]">{project.subtitle}</p>
            </div>
            <div class="flex items-center gap-2">
              <span class="badge">
                <Icon name="lucide:calendar" size={12} />
                {project.duration}
              </span>
            </div>
          </div>

          <p class="mt-4 text-sm leading-relaxed text-[var(--color-text-secondary)]">
            {project.description}
          </p>

          <!-- Tech stack with icons -->
          <div class="mt-5 flex flex-wrap gap-2">
            {project.techStack.map((tech) => {
              const info = techMap.get(tech);
              const Tag = info?.url ? "a" : "span";
              const linkProps = info?.url ? { href: info.url, target: "_blank", rel: "noopener noreferrer" } : {};
              return (
                <Tag
                  {...linkProps}
                  class="flex items-center gap-1.5 rounded-lg bg-[var(--color-bg-secondary)] px-2.5 py-1.5 text-xs text-[var(--color-text-secondary)] hover:scale-105 transition-transform duration-200"
                >
                  {info && (
                    <Icon
                      name={info.icon.includes(":") ? info.icon : `simple-icons:${info.icon}`}
                      size={14}
                      style={`color: ${info.color};${info.darkColor ? ` --skill-dark: ${info.darkColor};` : ""}`}
                    />
                  )}
                  {tech}
                </Tag>
              );
            })}
          </div>

          <!-- Tags + Links -->
          <div class="mt-5 flex flex-wrap items-center gap-3">
            {project.tags.map((tag) => (
              <span class="badge">{tag}</span>
            ))}
            <span class="flex-1" />
            {project.githubUrl && (
              <a
                href={project.githubUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-outline !py-1.5 !px-3 !text-xs"
                aria-label={`View ${project.title} on GitHub`}
              >
                <Icon name="simple-icons:github" size={14} />
                GitHub
              </a>
            )}
            {project.url && (
              <a
                href={project.url}
                target="_blank"
                rel="noopener noreferrer"
                class="btn-outline !py-1.5 !px-3 !text-xs"
              >
                <Icon name="lucide:external-link" size={14} />
                Website
              </a>
            )}
          </div>
        </article>
      ))}
    </div>
  </div>
</BaseLayout>
